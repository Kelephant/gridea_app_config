---
title: '运行时程序内存dump'
date: 2024-04-09 15:58:08
tags: [debug,gdb,coredump]
published: true
hideInList: false
feature: 
isTop: false
---
在实际的线上环境中，如果遇到了问题，程序没有退出，并且我们并不希望停止运行的程序时，就要求在在运行时调试程序

但是通过gdb attach调试，可能在操作过程中，会不小心破坏运行时程序，影响服务

这个时候可以将运行中的进程内存，dump下来，完了使用gdb调试dump下来的信息

<!-- more -->

# 具体操作

```
1. gcore 获取core dump
root@localhost:/share/wenqikai# gcore 177389
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
0x00007fad882d607b in pselect () from /lib/x86_64-linux-gnu/libc.so.6
warning: Memory read failed for corefile section, 4096 bytes at 0xffffffffff600000.
Saved corefile core.177389
[Inferior 1 (process 177389) detached]

2. 调试
root@localhost:/share/wenqikai# gdb /usr/bin/top ./core.177389 
GNU gdb (Ubuntu 9.2-0ubuntu1~20.04.1) 9.2
Copyright (C) 2020 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
Type "show copying" and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
Type "show configuration" for configuration details.
For bug reporting instructions, please see:
<http://www.gnu.org/software/gdb/bugs/>.
Find the GDB manual and other documentation resources online at:
    <http://www.gnu.org/software/gdb/documentation/>.

For help, type "help".
Type "apropos word" to search for commands related to "word"...
Reading symbols from /usr/bin/top...
(No debugging symbols found in /usr/bin/top)
[New LWP 177389]
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
Core was generated by `top'.
#0  0x00007fad882d607b in __pselect (nfds=1, readfds=0x7ffd719b9a60, writefds=0x0, exceptfds=0x0, timeout=<optimized out>, sigmask=0x55a455914380)
    at ../sysdeps/unix/sysv/linux/pselect.c:48
48      ../sysdeps/unix/sysv/linux/pselect.c: No such file or directory.
(gdb) bt
#0  0x00007fad882d607b in __pselect (nfds=1, readfds=0x7ffd719b9a60, writefds=0x0, exceptfds=0x0, timeout=<optimized out>, sigmask=0x55a455914380)
    at ../sysdeps/unix/sysv/linux/pselect.c:48
#1  0x000055a4558d2bba in ?? ()
#2  0x00007fad881e5083 in __libc_start_main (main=0x55a4558d1e00, argc=1, argv=0x7ffd719b9c98, init=<optimized out>, fini=<optimized out>, rtld_fini=<optimized out>, 
    stack_end=0x7ffd719b9c88) at ../csu/libc-start.c:308
#3  0x000055a4558d334e in ?? ()
(gdb) info threads 
  Id   Target Id                          Frame 
* 1    Thread 0x7fad87f4d7c0 (LWP 177389) 0x00007fad882d607b in __pselect (nfds=1, readfds=0x7ffd719b9a60, writefds=0x0, exceptfds=0x0, timeout=<optimized out>, 
    sigmask=0x55a455914380) at ../sysdeps/unix/sysv/linux/pselect.c:48
(gdb) qQuit
(gdb) qQuit
```